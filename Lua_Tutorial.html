<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<link rel="icon" type="image/x-icon" href="favicon.ico">
<title>Lua Tutorial</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .ges {
  font-weight: bold;
  font-style: italic;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Lua Tutorial</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_tutorial_00_installation">Tutorial #00 - Installation</a>
<ul class="sectlevel2">
<li><a href="#_choose_the_right_artifact_branch">Choose the right artifact branch</a></li>
<li><a href="#_download_the_archive">Download the archive</a></li>
<li><a href="#_run_the_example_script">Run the example script</a></li>
<li><a href="#_additional_resources">Additional resources</a></li>
</ul>
</li>
<li><a href="#_tutorial_01_callbacks_and_mouse">Tutorial #01 - Callbacks and mouse</a>
<ul class="sectlevel2">
<li><a href="#_basic_application_callbacks">Basic application callbacks</a>
<ul class="sectlevel3">
<li><a href="#_on_init_and_on_shutdown">on_init() and on_shutdown()</a></li>
<li><a href="#_on_frame_start">on_frame_start()</a></li>
<li><a href="#_on_pre_init">on_pre_init()</a></li>
</ul>
</li>
<li><a href="#_mouse_input">Mouse input</a>
<ul class="sectlevel3">
<li><a href="#_on_mouse_button_released">on_mouse_button_released()</a></li>
<li><a href="#_on_mouse_moved">on_mouse_moved()</a></li>
</ul>
</li>
<li><a href="#_putting_it_all_together">Putting it all together</a></li>
</ul>
</li>
<li><a href="#_tutorial_02_text">Tutorial #02 - Text</a>
<ul class="sectlevel2">
<li><a href="#_bitmap_fonts">Bitmap fonts</a></li>
<li><a href="#_font_and_text_node_objects">Font and text node objects</a></li>
<li><a href="#_additional_text_node_functions">Additional text node functions</a>
<ul class="sectlevel3">
<li><a href="#_dynamic_size_and_position">Dynamic size and position</a></li>
<li><a href="#_color">Color</a></li>
<li><a href="#_alignment">Alignment</a></li>
</ul>
</li>
<li><a href="#_putting_it_all_together_2">Putting it all together</a></li>
</ul>
</li>
<li><a href="#_tutorial_03_audio">Tutorial #03 - Audio</a>
<ul class="sectlevel2">
<li><a href="#_audio_buffer_and_player">Audio buffer and player</a></li>
<li><a href="#_music_and_stream_players">Music and stream players</a></li>
<li><a href="#_audio_player_properties">Audio player properties</a></li>
<li><a href="#_putting_it_all_together_3">Putting it all together</a></li>
</ul>
</li>
<li><a href="#_tutorial_04_animated_sprites">Tutorial #04 - Animated sprites</a>
<ul class="sectlevel2">
<li><a href="#_spritesheets_and_rectangles">Spritesheets and rectangles</a>
<ul class="sectlevel3">
<li><a href="#_creating_an_animated_sprite">Creating an animated sprite</a></li>
<li><a href="#_defining_a_list_of_rectangles">Defining a list of rectangles</a></li>
<li><a href="#_additional_animated_sprite_functions">Additional animated sprite functions</a></li>
</ul>
</li>
<li><a href="#_putting_it_all_together_4">Putting it all together</a></li>
</ul>
</li>
<li><a href="#_tutorial_05_keyboard_and_gamepad">Tutorial #05 - Keyboard and gamepad</a>
<ul class="sectlevel2">
<li><a href="#_keyboard_input">Keyboard input</a></li>
<li><a href="#_gamepad_input">Gamepad input</a>
<ul class="sectlevel3">
<li><a href="#_mapping">Mapping</a></li>
<li><a href="#_mapped_events">Mapped events</a></li>
</ul>
</li>
<li><a href="#_putting_it_all_together_5">Putting it all together</a></li>
</ul>
</li>
<li><a href="#_tutorial_06_the_scenegraph">Tutorial #06 - The Scenegraph</a>
<ul class="sectlevel2">
<li><a href="#_the_transformations_and_the_scenegraph">The transformations and the scenegraph</a></li>
<li><a href="#_modifying_the_scenegraph">Modifying the scenegraph</a></li>
<li><a href="#_putting_it_all_together_6">Putting it all together</a></li>
</ul>
</li>
<li><a href="#_tutorial_07_mesh_sprites">Tutorial #07 - Mesh sprites</a>
<ul class="sectlevel2">
<li><a href="#_uses_of_a_mesh_sprite">Uses of a mesh sprite</a></li>
<li><a href="#_creating_a_mesh_sprite">Creating a mesh sprite</a></li>
<li><a href="#_defining_a_list_of_vertices">Defining a list of vertices</a></li>
<li><a href="#_animating_the_vertices">Animating the vertices</a></li>
<li><a href="#_putting_it_all_together_7">Putting it all together</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_tutorial_00_installation">Tutorial #00 - Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The nCine offers an extensive Lua API that covers most of the native C++ API and allows you to create a complete 2D game.</p>
</div>
<div class="sect2">
<h3 id="_choose_the_right_artifact_branch">Choose the right artifact branch</h3>
<div class="paragraph">
<p>To run your Lua games you need to download the nCine. The specific Lua version is recommended in this case as it is easier to setup.</p>
</div>
<div class="paragraph">
<p>You can find all the pre-compiled archives on GitHub, as branches of the same nCine Artifacts repository.</p>
</div>
<div class="paragraph">
<p>The branch name format is <code>nCine-branch-platform-compiler</code>: <a href="https://github.com/nCine/nCine-artifacts/branches/all" class="bare">https://github.com/nCine/nCine-artifacts/branches/all</a></p>
</div>
<div class="paragraph">
<p>The Lua edition is called <code>nCineLua</code> and you usually want the <code>master</code> branch.
For example, if you are on Windows, you can choose the <code>nCine-master-windows-vs2022</code> branch (compiled with the latest Visual Studio 2022) and download the archive or the installer for the nCineLua version.</p>
</div>
</div>
<div class="sect2">
<h3 id="_download_the_archive">Download the archive</h3>
<div class="paragraph">
<p>Inside the branch you will find an archive, its format depends on the choosen platform.</p>
</div>
<div class="paragraph">
<p>You can extract the archive wherever you want and that&#8217;s the only installation step needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are inside a Windows branch you will also find an installer.
The nCine does not need to be installed though, you can download the ZIP archive.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_run_the_example_script">Run the example script</h3>
<div class="paragraph">
<p>Inside the extracted directory you will find an binary and a data directory.</p>
</div>
<div class="paragraph">
<p>Inside the binary directory you will find some libraries and an executable.</p>
</div>
<div class="paragraph">
<p>When you run the executable it will look for a file named <code>script.lua</code>, first in its same directory and then in the data one.</p>
</div>
<div class="paragraph">
<p>You can put your <code>script.lua</code> in either directories or you can execute a different script.
To do that open a command prompt and give the path of your script as the first parameter.</p>
</div>
<div class="paragraph">
<p>For your data files (like textures or sounds), you can use an absolute path or a path relative to the executable directory.
You can also put them in the data directory and use the default data path value returned by <code>ncine.fs.get_data_path()</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_additional_resources">Additional resources</h3>
<div class="paragraph">
<p>For a complete Lua API documentation, check the LDoc one at: <a href="https://ncine.github.io/docs/lua_master/" class="bare">https://ncine.github.io/docs/lua_master/</a></p>
</div>
<div class="paragraph">
<p>The nCine wiki offers further information: <a href="https://github.com/nCine/nCine/wiki/Getting-Started-with-Lua">Getting Started with Lua</a> and <a href="https://github.com/nCine/nCine/wiki/Getting-Started-with-Lua-VSCode)">Getting Started with Lua (VSCode)</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_01_callbacks_and_mouse">Tutorial #01 - Callbacks and mouse</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_basic_application_callbacks">Basic application callbacks</h3>
<div class="paragraph">
<p>One of the first concepts to learn is the life cycle of your application and the associated event callbacks.</p>
</div>
<div class="paragraph">
<p>Callback functions are automatically called by the framework in particular moments during the life of the game, for example at the beginning of a frame or at shutdown.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s write a small example that uses them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_init</span><span class="p">()</span>
	<span class="n">texture_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"textures/texture2.png"</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_resolution</span><span class="p">()</span>
	<span class="n">pos_</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">}</span>
	<span class="n">sprite_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_rootnode</span><span class="p">(),</span> <span class="n">texture_</span><span class="p">,</span> <span class="n">pos_</span><span class="p">)</span>

	<span class="n">angle_</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_frame_start</span><span class="p">()</span>
	<span class="n">angle_</span> <span class="o">=</span> <span class="n">angle_</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_frame_time</span><span class="p">()</span>

	<span class="kd">local</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">2</span>
	<span class="kd">local</span> <span class="n">newpos</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos_</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="nb">math.sin</span><span class="p">(</span><span class="n">angle_</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos_</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="nb">math.cos</span><span class="p">(</span><span class="n">angle_</span><span class="p">)}</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">sprite_</span><span class="p">,</span> <span class="n">newpos</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_shutdown</span><span class="p">()</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">sprite_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">texture_</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line is just a way to create a shorter alias for the <code>ncine</code> table: the API access point.</p>
</div>
<div class="sect3">
<h4 id="_on_init_and_on_shutdown">on_init() and on_shutdown()</h4>
<div class="paragraph">
<p>The <code>on_init()`function is called only once, at the beginning of your application. Here we are creating a new texture and a new sprite using the special `new()</code> function.</p>
</div>
<div class="paragraph">
<p>The <code>on_shutdown()</code> function is its mirror, it is called before the application quits and should be used to free any resources created for the game: there is one <code>delete()</code> for each <code>new()</code> we called earlier.</p>
</div>
<div class="paragraph">
<p>All functions that work on objects created with a <code>new()</code> need those objects as their first parameter, and <code>delete()</code> is no exception.</p>
</div>
<div class="paragraph">
<p>To create a texture object we just need the filename of an image file. You can use an absolute path but in this example we are using the <code>data/</code> directory by asking the filesystem table <code>fs</code> for the default data path.</p>
</div>
<div class="paragraph">
<p>Next we create a sprite object by passing four parameters to the <code>sprite.new()</code> function: a parent node, a texture object, and the X and Y coordinates of the initial position.</p>
</div>
<div class="paragraph">
<p>As a parent node we use the root node of the scenegraph by calling the <code>get_rootnode()</code> function of the <code>application</code> table. Every sprite that you want to display on screen needs to be a child of this node or to have an ancestor that is a child of this node.</p>
</div>
<div class="paragraph">
<p>The other function from the <code>application</code> table, <code>get_resolution</code>, returns the resolution of the screen and it is used here to place the sprite at the center of the screen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_on_frame_start">on_frame_start()</h4>
<div class="paragraph">
<p>The <code>on_frame_start()</code> function is where most of the game logic happens, it is called once at the beginning of each frame and allows you to update objects, like move sprite arounds, play sounds, and so on.</p>
</div>
<div class="paragraph">
<p>In this example we move the sprite in a circle path by using some simple trigonometry and the Lua math library.</p>
</div>
<div class="paragraph">
<p>We increment the <code>angle_</code> variable and use it to update the sprite position with the <code>sprite.set_position()</code> function. By using the time elapsed since last frame, we keep a stable rotation regardless of frame time oscillations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_on_pre_init">on_pre_init()</h4>
<div class="paragraph">
<p>We can make the example a bit more flexible by configuring some aspects before our application or the framework even initialize.</p>
</div>
<div class="paragraph">
<p>For this we can use the <code>on_pre_init()</code> callback. It receives a configuration table that we can modify before returning it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_pre_init</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
	<span class="n">cfg</span><span class="p">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">720</span><span class="p">}</span>
	<span class="n">cfg</span><span class="p">.</span><span class="n">window_title</span> <span class="o">=</span> <span class="s2">"nCine example"</span>
	<span class="k">return</span> <span class="n">cfg</span>
<span class="k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are many more variables in this table, but for this example we are just setting the initial window resolution and title.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mouse_input">Mouse input</h3>
<div class="sect3">
<h4 id="_on_mouse_button_released">on_mouse_button_released()</h4>
<div class="paragraph">
<p>Even if we a have a moving sprite on screen, this example is still boring: we cannot interact with it.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s remedy to this by adding the ability to move the sprite around with the mouse.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_mouse_button_released</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">mouse_button</span><span class="p">.</span><span class="n">LEFT</span> <span class="k">then</span>
		<span class="n">pos_</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">y</span><span class="p">}</span>
	<span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>on_mouse_button_released()</code> function is called every time the user releases a mouse button. It receives an event table with additional information, like which button was released.</p>
</div>
<div class="paragraph">
<p>We are performing this check by comparing the <code>button</code> variable with the <code>mouse_button.LEFT</code> constant value. Those special constant values are usually written with capital letters.</p>
</div>
<div class="paragraph">
<p>If the user released the left button, we update the <code>pos_</code> variable that will be used as the center of the rotation animation in the <code>on_frame_start()</code> function.</p>
</div>
<div class="paragraph">
<p>The coordinates of the mouse at the time a button was released are accessible in the <code>x</code> and <code>y</code> variables of the same table.</p>
</div>
</div>
<div class="sect3">
<h4 id="_on_mouse_moved">on_mouse_moved()</h4>
<div class="paragraph">
<p>You will soon discover that smashing the mouse button is not an optimal way for continuously updating the sprite position. For this you need a different function.</p>
</div>
<div class="paragraph">
<p>The <code>on_mouse_moved()</code> function is called every time the mouse is moved and receives a state table that you can query in a way similar to the event one of <code>on_mouse_button_released()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_mouse_moved</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">state</span><span class="p">.</span><span class="n">is_left_down</span> <span class="k">then</span>
		<span class="n">pos_</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">y</span><span class="p">}</span>
	<span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this snippet we first check if we are moving the mouse while pressing the left mouse button by checking the value of the <code>is_left_down</code> boolean variable, then we use the <code>x</code> and <code>y</code> variables to update the position.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_putting_it_all_together">Putting it all together</h3>
<div class="listingblock">
<div class="title">Complete example #01</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_pre_init</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
	<span class="n">cfg</span><span class="p">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">720</span><span class="p">}</span>
	<span class="n">cfg</span><span class="p">.</span><span class="n">window_title</span> <span class="o">=</span> <span class="s2">"nCine example"</span>
	<span class="k">return</span> <span class="n">cfg</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_init</span><span class="p">()</span>
	<span class="n">texture_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"textures/texture2.png"</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_resolution</span><span class="p">()</span>
	<span class="n">pos_</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">}</span>
	<span class="n">sprite_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_rootnode</span><span class="p">(),</span> <span class="n">texture_</span><span class="p">,</span> <span class="n">pos_</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pos_</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>

	<span class="n">angle_</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_frame_start</span><span class="p">()</span>
	<span class="n">angle_</span> <span class="o">=</span> <span class="n">angle_</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_frame_time</span><span class="p">()</span>

	<span class="kd">local</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">2</span>
	<span class="kd">local</span> <span class="n">newpos</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos_</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="nb">math.sin</span><span class="p">(</span><span class="n">angle_</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos_</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="nb">math.cos</span><span class="p">(</span><span class="n">angle_</span><span class="p">)}</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">sprite_</span><span class="p">,</span> <span class="n">newpos</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_shutdown</span><span class="p">()</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">sprite_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">texture_</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_mouse_button_released</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">mouse_button</span><span class="p">.</span><span class="n">LEFT</span> <span class="k">then</span>
		<span class="n">pos_</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">y</span><span class="p">}</span>
	<span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_mouse_moved</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">state</span><span class="p">.</span><span class="n">is_left_down</span> <span class="k">then</span>
		<span class="n">pos_</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">y</span><span class="p">}</span>
	<span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_02_text">Tutorial #02 - Text</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_bitmap_fonts">Bitmap fonts</h3>
<div class="paragraph">
<p>With the latest tutorial you learnt how to load a texture and create a sprite from it.
In this one you will see how to load a font and display some text on screen.</p>
</div>
<div class="paragraph">
<p>nCine uses bitmap fonts: they are special textures that contains all the characters.
The information about how to render a text from those textures is contained in a FNT file. It is a text file that tells where every character is located inside the texture.</p>
</div>
<div class="paragraph">
<p>To create a font texture and the corresponding FNT description file you can use the <a href="https://www.angelcode.com/products/bmfont/">Bitmap Font Generator</a> or other tools that support AngelCode&#8217;s format.</p>
</div>
</div>
<div class="sect2">
<h3 id="_font_and_text_node_objects">Font and text node objects</h3>
<div class="paragraph">
<p>To create a new font object you can use the <code>font.new()</code> function. As usual, remember to call <code>font.delete()</code> when you are done with it.</p>
</div>
<div class="paragraph">
<p>The parameters for this function are the path to a FNT file and the path to a texture file (be careful, it is <strong>not</strong> a texture object).</p>
</div>
<div class="paragraph">
<p>To display some text on screen you also need a text node. Just like a sprite, it has to be a child of the root node or have an ancestor that is a child of the root node.</p>
</div>
<div class="paragraph">
<p>You also need to associate it with the font to use: <code>textnode.new(rootnode, font, 256)</code>.</p>
</div>
<div class="paragraph">
<p>The last parameter is the maximum length allowed for the text to be displayed. You can tune this value around the use you want to do of your text node, to optimize performance and memory usage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_init</span><span class="p">()</span>
	<span class="kd">local</span> <span class="n">rootnode</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_rootnode</span><span class="p">()</span>

	<span class="n">font_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"fonts/DroidSans32_256.fnt"</span><span class="p">,</span>
	                    <span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"fonts/DroidSans32_256.png"</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_resolution</span><span class="p">()</span>
	<span class="n">textnode_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">textnode</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">rootnode</span><span class="p">,</span> <span class="n">font_</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">textnode</span><span class="p">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">textnode_</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_frame_start</span><span class="p">()</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">textnode</span><span class="p">.</span><span class="n">set_string</span><span class="p">(</span><span class="n">textnode_</span><span class="p">,</span> <span class="nb">string.format</span><span class="p">(</span><span class="s2">"FPS: %.2f"</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">/</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_frame_time</span><span class="p">()))</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_shutdown</span><span class="p">()</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">textnode</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">textnode_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">font_</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_additional_text_node_functions">Additional text node functions</h3>
<div class="sect3">
<h4 id="_dynamic_size_and_position">Dynamic size and position</h4>
<div class="paragraph">
<p>We can make this example even better by positioning the text in one of the screen&#8217;s corners.</p>
</div>
<div class="paragraph">
<p>To do that we need to know how tall and how wide is the text that we are rendering.
We can do exactly that with the <code>get_width()</code> and the <code>get_height()</code> functions.</p>
</div>
<div class="paragraph">
<p>If we are changing the string each frame, like in this example, we need to reposition the text each frame to take into account the changes in size.</p>
</div>
</div>
<div class="sect3">
<h4 id="_color">Color</h4>
<div class="paragraph">
<p>Changing the color of a text node is simple: you just have to call the <code>set_color()</code> function with the four color channel values (red, green, blue, and alpha).</p>
</div>
<div class="paragraph">
<p>For example, <code>nc.textnode.set_color(textnode_, 1, 1, 0, 1)</code> will make the text yellow.</p>
</div>
</div>
<div class="sect3">
<h4 id="_alignment">Alignment</h4>
<div class="paragraph">
<p>When the string to render has at least one <code>\n</code> character the text will span multiple lines.</p>
</div>
<div class="paragraph">
<p>In this case you can choose how to align them (left, right, or center) with the <code>set_alignment()</code> function.</p>
</div>
<div class="paragraph">
<p>For example, <code>nc.textnode.set_alignment(textnode_, nc.text_alignment.CENTER)</code> will align multiple lines at the center.</p>
</div>
<div class="paragraph">
<p>To set the alignment, we have used again a special constant value. There are three values: <code>nc.text_alignment.LEFT</code>, <code>nc.text_alignment.RIGHT</code>, and <code>nc.text_alignment.CENTER</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_putting_it_all_together_2">Putting it all together</h3>
<div class="listingblock">
<div class="title">Complete example #02</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_pre_init</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
	<span class="n">cfg</span><span class="p">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">720</span><span class="p">}</span>
	<span class="n">cfg</span><span class="p">.</span><span class="n">window_title</span> <span class="o">=</span> <span class="s2">"nCine example"</span>
	<span class="n">cfg</span><span class="p">.</span><span class="n">console_log_level</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">log_level</span><span class="p">.</span><span class="n">INFO</span>
	<span class="k">return</span> <span class="n">cfg</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_init</span><span class="p">()</span>
	<span class="kd">local</span> <span class="n">rootnode</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_rootnode</span><span class="p">()</span>

	<span class="n">font_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"fonts/DroidSans32_256.fnt"</span><span class="p">,</span>
	                    <span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"fonts/DroidSans32_256.png"</span><span class="p">)</span>

	<span class="n">textnode_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">textnode</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">rootnode</span><span class="p">,</span> <span class="n">font_</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">textnode</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">textnode_</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">textnode</span><span class="p">.</span><span class="n">set_alignment</span><span class="p">(</span><span class="n">textnode_</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">text_alignment</span><span class="p">.</span><span class="n">LEFT</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_frame_start</span><span class="p">()</span>
	<span class="kd">local</span> <span class="n">str</span> <span class="o">=</span> <span class="nb">string.format</span><span class="p">(</span><span class="s2">"FPS: %.2f</span><span class="se">\n</span><span class="s2">Frame time: %.2f ms"</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">/</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_frame_time</span><span class="p">(),</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_frame_time</span><span class="p">())</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">textnode</span><span class="p">.</span><span class="n">set_string</span><span class="p">(</span><span class="n">textnode_</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">textnode</span><span class="p">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">textnode_</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">textnode</span><span class="p">.</span><span class="n">get_width</span><span class="p">(</span><span class="n">textnode_</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>
	                                    <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">-</span> <span class="n">nc</span><span class="p">.</span><span class="n">textnode</span><span class="p">.</span><span class="n">get_height</span><span class="p">(</span><span class="n">textnode_</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_shutdown</span><span class="p">()</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">textnode</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">textnode_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">font_</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_03_audio">Tutorial #03 - Audio</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_audio_buffer_and_player">Audio buffer and player</h3>
<div class="paragraph">
<p>To play sounds and music you have to first load the audio data and then associate it with a player.
The concept is similar to textures and sprites, or fonts and text nodes.</p>
</div>
<div class="paragraph">
<p>In this case the two objects are <code>audio_buffer</code> and <code>audio_buffer_player</code>.</p>
</div>
<div class="paragraph">
<p>The <code>audio_buffer.new()</code> function takes the path to a WAV or OGG Vorbis file, while the <code>audio_buffer_player.new()</code> function takes the audio buffer object you have just created.</p>
</div>
<div class="paragraph">
<p>Once the player has been created, you can use the <code>play()</code>, <code>pause()</code>, and <code>stop()</code> functions to control it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_init</span><span class="p">()</span>
	<span class="n">audio_buffer_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"sounds/coins.ogg"</span><span class="p">)</span>
	<span class="n">player_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">audio_buffer_</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_mouse_button_released</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">stop</span><span class="p">(</span><span class="n">player_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">play</span><span class="p">(</span><span class="n">player_</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_shutdown</span><span class="p">()</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">player_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">audio_buffer_</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_music_and_stream_players">Music and stream players</h3>
<div class="paragraph">
<p>When you have a big music file you don&#8217;t usually want to load all of it in memory.</p>
</div>
<div class="paragraph">
<p>It is preferable to stream it: to load and decode only the small part that is currently being played.</p>
</div>
<div class="paragraph">
<p>You can achieve this by using an <code>audio_stream_player</code>. It can be controlled with the same <code>play()</code>, <code>pause()</code>, and <code>stop()</code> functions.</p>
</div>
<div class="paragraph">
<p>To create an <code>audio_stream_player</code> you don&#8217;t need an <code>audio_buffer</code>, you just pass the file to load, like this: <code>nc.audio_stream_player.new(nc.fs.get_data_path().."sounds/music.ogg")</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_audio_player_properties">Audio player properties</h3>
<div class="paragraph">
<p>You can set some properties for both type of players, like the gain (volume), the pitch, or the looping state.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua">	<span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">set_gain</span><span class="p">(</span><span class="n">audio_buffer_</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">set_pitch</span><span class="p">(</span><span class="n">audio_buffer_</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">audio_stream_player</span><span class="p">.</span><span class="n">set_looping</span><span class="p">(</span><span class="n">stream_player_</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can query those properties with <code>get_gain()</code>, <code>get_pitch()</code>, and <code>is_looping()</code>.</p>
</div>
<div class="paragraph">
<p>You can also query the state of the player with functions like <code>is_playing()</code>, <code>is_paused()</code>, or <code>is_stopped()</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_putting_it_all_together_3">Putting it all together</h3>
<div class="listingblock">
<div class="title">Complete example #03</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_init</span><span class="p">()</span>
	<span class="n">audio_buffer_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"sounds/coins.ogg"</span><span class="p">)</span>
	<span class="n">player_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">audio_buffer_</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_shutdown</span><span class="p">()</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">player_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">audio_buffer_</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_mouse_button_released</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">looping</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">is_looping</span><span class="p">(</span><span class="n">player_</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">mouse_button</span><span class="p">.</span><span class="n">LEFT</span> <span class="k">then</span>
		<span class="k">if</span> <span class="n">looping</span> <span class="o">==</span> <span class="kc">false</span> <span class="k">then</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">stop</span><span class="p">(</span><span class="n">player_</span><span class="p">)</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">play</span><span class="p">(</span><span class="n">player_</span><span class="p">)</span>
		<span class="k">else</span>
			<span class="kd">local</span> <span class="n">playing</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">is_playing</span><span class="p">(</span><span class="n">player_</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">playing</span> <span class="k">then</span>
				<span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">pause</span><span class="p">(</span><span class="n">player_</span><span class="p">)</span>
			<span class="k">else</span>
				<span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">play</span><span class="p">(</span><span class="n">player_</span><span class="p">)</span>
			<span class="k">end</span>
		<span class="k">end</span>
	<span class="k">elseif</span> <span class="n">event</span><span class="p">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">mouse_button</span><span class="p">.</span><span class="n">RIGHT</span> <span class="k">then</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">audio_buffer_player</span><span class="p">.</span><span class="n">set_looping</span><span class="p">(</span><span class="n">player_</span><span class="p">,</span> <span class="ow">not</span> <span class="n">looping</span><span class="p">)</span>
	<span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_04_animated_sprites">Tutorial #04 - Animated sprites</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_spritesheets_and_rectangles">Spritesheets and rectangles</h3>
<div class="paragraph">
<p>For this tutorial we are going to learn how to create an animated sprite using a spritesheet with separated walk frames.</p>
</div>
<div class="paragraph">
<p>First of all we need to load the spritesheet texture. There is nothing special about a texture that contains more than one image, we load it as usual.</p>
</div>
<div class="paragraph">
<p>The difference is in how the sprite (regular or animated) is going to use only a portion of that texture, by definiing a rectangle.</p>
</div>
<div class="paragraph">
<p>When an nCine method needs a rectangle, it refers to a table that defines a top-left corner, a width, and a height: <code>rect = {x = 0, y = 0, w = 128, h = 128}</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The concept of a bigger texture containing more sub-images (being frames of an animation or just different sprites) can also be called a texture atlas.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_creating_an_animated_sprite">Creating an animated sprite</h4>
<div class="paragraph">
<p>The following snippet of code loads a textures and assigns it to an animated sprite.
Then it defines an animation, it adds it to the animated sprite, and make it active.
The last step is removing the pause to see the sprite animate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_init</span><span class="p">()</span>
	<span class="n">spritesheet_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"textures/spritesheet.png"</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_resolution</span><span class="p">()</span>
	<span class="n">anim_sprite_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_rootnode</span><span class="p">(),</span> <span class="n">spritesheet_</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">animation</span> <span class="o">=</span> <span class="p">{</span> <span class="n">frame_duration</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span> <span class="n">loop_mode</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">loop_mode</span><span class="p">.</span><span class="n">ENABLED</span><span class="p">,</span> <span class="n">rewind_mode</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">rewind_mode</span><span class="p">.</span><span class="n">FROM_START</span><span class="p">,</span> <span class="n">rect_size</span> <span class="o">=</span> <span class="p">{</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">48</span> <span class="p">},</span> <span class="n">source_rect</span> <span class="o">=</span> <span class="p">{</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">144</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">96</span> <span class="p">}</span> <span class="p">}</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">add_animation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="n">animation</span><span class="p">)</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_animation_index</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_paused</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_shutdown</span><span class="p">()</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">spritesheet_</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But how did we define an animation? We created a table with various keys.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>frame_duration</code> key specifies how many seconds should a frame stay on screen before the next one will be displayed.</p>
</li>
<li>
<p>The <code>loop_mode</code> key is used to define if the animation will continue playing after it reaches the last frame.</p>
</li>
<li>
<p>It can have two values: <code>nc.loop_mode.ENABLED</code> or <code>nc.loop_mode.DISABLED</code>.</p>
</li>
<li>
<p>The <code>rewind_mode</code> key is used to define what happens when a looping animation reaches the last frame. Should it start again from the first one or go backward until the first one before playing again normally?</p>
</li>
<li>
<p>It can have two values: <code>nc.rewind_mode.FROM_START</code> or <code>nc.rewind_mode.BACKWARD</code>.</p>
</li>
<li>
<p>The <code>rect_size</code> is a two component vector (like the return value of <code>nc.application.get_resolution()</code>, for example) that specifies the size of a frame</p>
</li>
<li>
<p>The <code>source_rect</code> is a rectangle area inside the texture that will be used to create frames. The frames will all have the size you specified earlier. They will start at the corner defined by the <code>x</code> and <code>y</code> components, and proceeds from left to right and from top to bottom, within the bounds defined by the <code>x + w</code> and <code>y + h</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are also two more optional keys that you can use to achieve more flexibility.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>num_rectangles_to_skip</code> key is a number that specifies how many frames should be skipped before adding rectangles from the <code>source_rect</code> area.</p>
</li>
<li>
<p>The <code>padding</code> key is a two component vector that defines the horizontal and vertical distance between adjacent rectangles.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_defining_a_list_of_rectangles">Defining a list of rectangles</h4>
<div class="paragraph">
<p>There is an alternative way of defining the rectangles that compose an animation. It can be used when the automatic way shown in the previous paragraph is not flexible enough for your needs.</p>
</div>
<div class="paragraph">
<p>As before, you will provide a value for the <code>frame_duration</code>, <code>loop_mode</code>, and <code>rewind_mode</code> keys. But after those you can list the rectangles you need for your animation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="kd">local</span> <span class="n">animation</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">frame_duration</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span> <span class="n">loop_mode</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">loop_mode</span><span class="p">.</span><span class="n">ENABLED</span><span class="p">,</span> <span class="n">rewind_mode</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">rewind_mode</span><span class="p">.</span><span class="n">FROM_START</span><span class="p">,</span>
	<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">48</span><span class="p">},</span>
	<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">48</span><span class="p">},</span>
	<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">96</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">48</span><span class="p">},</span>
	<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">144</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">48</span><span class="p">},</span>
	<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">48</span><span class="p">},</span>
	<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">48</span><span class="p">},</span>
	<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">96</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">48</span><span class="p">},</span>
	<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">144</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">48</span><span class="p">},</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_additional_animated_sprite_functions">Additional animated sprite functions</h4>
<div class="paragraph">
<p>There are some more useful functions that you can use with <code>animated_sprite</code> objets.</p>
</div>
<div class="paragraph">
<p>If you add more than one animation you can query the number with <code>num_animations</code> then, as you have seen earlier, you can set the active one with <code>set_animation_index()</code>, or query it with <code>get_animation_index()</code>.
You can then clear all animations with <code>clear_animations()</code>.</p>
</div>
<div class="paragraph">
<p>You can play or pause the animation by using <code>set_paused()</code> and query its state with <code>is_paused()</code>.</p>
</div>
<div class="paragraph">
<p>You can also handle the animation yourself by changing the frame with <code>set_frame()</code>, and querying the active one with <code>get_frame()</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_putting_it_all_together_4">Putting it all together</h3>
<div class="listingblock">
<div class="title">Complete example #04</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_init</span><span class="p">()</span>
	<span class="n">spritesheet_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"textures/spritesheet.png"</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_resolution</span><span class="p">()</span>
	<span class="n">anim_sprite_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_rootnode</span><span class="p">(),</span> <span class="n">spritesheet_</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">animation</span> <span class="o">=</span> <span class="p">{</span> <span class="n">frame_duration</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span> <span class="n">loop_mode</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">loop_mode</span><span class="p">.</span><span class="n">ENABLED</span><span class="p">,</span> <span class="n">rewind_mode</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">rewind_mode</span><span class="p">.</span><span class="n">FROM_START</span><span class="p">,</span> <span class="n">rect_size</span> <span class="o">=</span> <span class="p">{</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">48</span> <span class="p">},</span> <span class="n">source_rect</span> <span class="o">=</span> <span class="p">{</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">144</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">96</span> <span class="p">}</span> <span class="p">}</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">add_animation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="n">animation</span><span class="p">)</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_animation_index</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_paused</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_shutdown</span><span class="p">()</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">spritesheet_</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_mouse_button_released</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">mouse_button</span><span class="p">.</span><span class="n">LEFT</span> <span class="k">then</span>
		<span class="kd">local</span> <span class="n">is_paused</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">is_paused</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">)</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_paused</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="ow">not</span> <span class="n">is_paused</span><span class="p">)</span>
	<span class="k">elseif</span> <span class="n">event</span><span class="p">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">mouse_button</span><span class="p">.</span><span class="n">RIGHT</span> <span class="k">then</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_paused</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

		<span class="kd">local</span> <span class="n">num_frames</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">num_frames</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">)</span>
		<span class="kd">local</span> <span class="n">frame_index</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">)</span>
		<span class="n">frame_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">num_frames</span>

		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_frame</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="n">frame_index</span><span class="p">)</span>
	<span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_05_keyboard_and_gamepad">Tutorial #05 - Keyboard and gamepad</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_keyboard_input">Keyboard input</h3>
<div class="paragraph">
<p>In this tutorial we are going to learn more about user inputs.</p>
</div>
<div class="paragraph">
<p>The are two ways of looking at inputs: you can query their current state or you can listen for events (a change in state).</p>
</div>
<div class="paragraph">
<p>The keyboard inputs work just the same. You can query for their state (which keys are pressed in this frame) or you can react to events (the user pressing or releasing a key).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s build an example using the animated sprite from last tutorial.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_frame_start</span><span class="p">()</span>
	<span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">get_position</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_frame_time</span><span class="p">()</span>
	<span class="kd">local</span> <span class="n">moved</span> <span class="o">=</span> <span class="kc">false</span>

	<span class="kd">local</span> <span class="n">key_state</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">key_state</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">UP</span><span class="p">)</span> <span class="ow">or</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">W</span><span class="p">)</span> <span class="k">then</span>
		<span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">step</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
		<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
	<span class="k">elseif</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">DOWN</span><span class="p">)</span> <span class="ow">or</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">S</span><span class="p">)</span> <span class="k">then</span>
		<span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">step</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
	<span class="k">elseif</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">LEFT</span><span class="p">)</span> <span class="ow">or</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">A</span><span class="p">)</span> <span class="k">then</span>
		<span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">step</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">270</span><span class="p">)</span>
		<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
	<span class="k">elseif</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">RIGHT</span><span class="p">)</span> <span class="ow">or</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">D</span><span class="p">)</span> <span class="k">then</span>
		<span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">step</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
		<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
	<span class="k">end</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_paused</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="ow">not</span> <span class="n">moved</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">moved</span> <span class="k">then</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
	<span class="k">else</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_frame</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_key_released</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">sym</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">ESCAPE</span> <span class="k">then</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
	<span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we are using the keyboard state to move the animated sprite.</p>
</div>
<div class="paragraph">
<p>We first get the current position on screen and calculate a movement based on the last frame time, then we check which key is down this frame.</p>
</div>
<div class="paragraph">
<p>The current keyboard state is retrieved using <code>input.key_state()</code>. We then use <code>input.is_key_down()</code> on the state object to query if a specific key is down.
We check both arrows and <code>WASD</code> keys to offer the user two ways of moving our animated sprite.</p>
</div>
<div class="paragraph">
<p>If the user presses one of these keys we update the position vector and change the sprite rotation with <code>set_rotation()</code>.</p>
</div>
<div class="paragraph">
<p>We also set the value of the <code>moved</code> flag that will later be used to play/pause the animation, set the sprite position, and reset the animation frame.</p>
</div>
<div class="paragraph">
<p>The snippet also shows the use of the <code>on_key_released()</code> event callback. The <code>event</code> table received by the function contains a <code>sym</code> key, its value can be checked against the <code>keysym</code> table just like we did before with the keyboard state.</p>
</div>
<div class="paragraph">
<p>As you might expect, there is also a mirror <code>on_key_pressed()</code> event callback that is called when the user press a key.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gamepad_input">Gamepad input</h3>
<div class="sect3">
<h4 id="_mapping">Mapping</h4>
<div class="paragraph">
<p>The gamepad input works in a similar way: you can query its state or listen for events.</p>
</div>
<div class="paragraph">
<p>You need to know that there are two different "modes" when it comes to the gamepad: the raw state adn events and the mapped ones.</p>
</div>
<div class="paragraph">
<p>When you connect a gamepad, the system will assign a number id to its axes and buttons, but you will not know which button is the "Start" button, for example.</p>
</div>
<div class="paragraph">
<p>You can, of course, ask the user to assign known values by telling him or her to press a button or move an axis when you are ready to detect a specific button or axis.</p>
</div>
<div class="paragraph">
<p>This work is called mapping, and fortunately it has already been done for a long list of devices. The nCine uses the <a href="https://github.com/libsdl-org/SDL/blob/main/src/joystick/SDL_gamepad_db.h">SDL mapping database</a>.</p>
</div>
<div class="paragraph">
<p>The mapping uses the XBox gamepad as a model and assigns each axis and button to this layout.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mapped_events">Mapped events</h4>
<div class="paragraph">
<p>If your gamepad is found in the mapping database, you can use the mapped state and events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_joymapped_axis_moved</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">get_position</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_frame_time</span><span class="p">()</span>
	<span class="kd">local</span> <span class="n">moved</span> <span class="o">=</span> <span class="kc">false</span>

	<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">axis</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">joy_axis</span><span class="p">.</span><span class="n">LY</span> <span class="k">then</span>
		<span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="n">event</span><span class="p">.</span><span class="n">value</span>
		<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
			<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
		<span class="k">elseif</span> <span class="n">event</span><span class="p">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">mnvoed</span> <span class="o">=</span> <span class="kc">true</span>
		<span class="k">end</span>
	<span class="k">elseif</span> <span class="n">event</span><span class="p">.</span><span class="n">axis</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">joy_axis</span><span class="p">.</span><span class="n">LX</span> <span class="k">then</span>
		<span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="n">event</span><span class="p">.</span><span class="n">value</span>
		<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">270</span><span class="p">)</span>
			<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
		<span class="k">elseif</span> <span class="n">event</span><span class="p">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
			<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
		<span class="k">end</span>
	<span class="k">end</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_paused</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="ow">not</span> <span class="n">moved</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">moved</span> <span class="k">then</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
	<span class="k">else</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_frame</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_joymapped_button_released</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">joy_button</span><span class="p">.</span><span class="n">GUIDE</span> <span class="k">then</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
	<span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code is similar to the one we used to handle keyboard input, but we are using events this time.</p>
</div>
<div class="paragraph">
<p>The <code>on_joymapped_axis_moved()</code> callback receives an <code>event</code> table that has an <code>axis</code> and a <code>value</code> key, by querying them you will now which axis has been moved and its new position.</p>
</div>
<div class="paragraph">
<p>The <code>LY</code> and <code>LX</code> axes are the vertical and horizontal direction of the left stick. But you can also use <code>RY</code> and <code>RX</code> if you want to use the right stick.
The two remaining axes in the mapping model are <code>LTRIGGER</code> and <code>RTRIGGER</code> for the two analog triggers (also called <em>LT</em> or <em>L2</em>, and <em>RT</em> and <em>R2</em>).</p>
</div>
<div class="paragraph">
<p>Just as we did with the keyboard, we are also listening to the <code>on_joymapped_button_released()</code> event to quit the application when the user preses the <code>GUIDE</code> button.
There is, of course, also a <code>on_joymapped_button_pressed()</code> callback, as well as a list of buttons you can react to.</p>
</div>
<div class="paragraph">
<p>The available mapped buttons are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>A</code>, <code>B</code>, <code>X</code>, <code>Y</code></p>
</li>
<li>
<p><code>BACK</code>, <code>GUIDE</code>, <code>START</code></p>
</li>
<li>
<p><code>LSTICK</code>, <code>RSTICK</code></p>
</li>
<li>
<p><code>LBUMPER</code>, <code>RBUMPER</code></p>
</li>
<li>
<p><code>DPAD_UP</code>, <code>DPAD_DOWN</code>, <code>DPAD_LEFT</code>, <code>DPAD_RIGHT</code>,</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_putting_it_all_together_5">Putting it all together</h3>
<div class="listingblock">
<div class="title">Complete example #05</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_init</span><span class="p">()</span>
	<span class="n">spritesheet_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"textures/spritesheet.png"</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_resolution</span><span class="p">()</span>
	<span class="n">anim_sprite_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_rootnode</span><span class="p">(),</span> <span class="n">spritesheet_</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">animation</span> <span class="o">=</span> <span class="p">{</span> <span class="n">frame_duration</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span> <span class="n">loop_mode</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">loop_mode</span><span class="p">.</span><span class="n">ENABLED</span><span class="p">,</span> <span class="n">rewind_mode</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">rewind_mode</span><span class="p">.</span><span class="n">FROM_START</span><span class="p">,</span> <span class="n">rect_size</span> <span class="o">=</span> <span class="p">{</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">48</span> <span class="p">},</span> <span class="n">source_rect</span> <span class="o">=</span> <span class="p">{</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">144</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">96</span> <span class="p">}</span> <span class="p">}</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">add_animation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="n">animation</span><span class="p">)</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_animation_index</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_paused</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_frame_start</span><span class="p">()</span>
	<span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">get_position</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_frame_time</span><span class="p">()</span>
	<span class="kd">local</span> <span class="n">moved</span> <span class="o">=</span> <span class="kc">false</span>

	<span class="kd">local</span> <span class="n">key_state</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">key_state</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">UP</span><span class="p">)</span> <span class="ow">or</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">W</span><span class="p">)</span> <span class="k">then</span>
		<span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">step</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
		<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
	<span class="k">elseif</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">DOWN</span><span class="p">)</span> <span class="ow">or</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">S</span><span class="p">)</span> <span class="k">then</span>
		<span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">step</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
	<span class="k">elseif</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">LEFT</span><span class="p">)</span> <span class="ow">or</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">A</span><span class="p">)</span> <span class="k">then</span>
		<span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">step</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">270</span><span class="p">)</span>
		<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
	<span class="k">elseif</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">RIGHT</span><span class="p">)</span> <span class="ow">or</span> <span class="n">nc</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">is_key_down</span><span class="p">(</span><span class="n">key_state</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">D</span><span class="p">)</span> <span class="k">then</span>
		<span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">step</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
		<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
	<span class="k">end</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_paused</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="ow">not</span> <span class="n">moved</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">moved</span> <span class="k">then</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
	<span class="k">else</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_frame</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_shutdown</span><span class="p">()</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">spritesheet_</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_key_released</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">sym</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">ESCAPE</span> <span class="k">then</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
	<span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_joymapped_axis_moved</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">get_position</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_frame_time</span><span class="p">()</span>
	<span class="kd">local</span> <span class="n">moved</span> <span class="o">=</span> <span class="kc">false</span>

	<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">axis</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">joy_axis</span><span class="p">.</span><span class="n">LY</span> <span class="k">then</span>
		<span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="n">event</span><span class="p">.</span><span class="n">value</span>
		<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
			<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
		<span class="k">elseif</span> <span class="n">event</span><span class="p">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">mnvoed</span> <span class="o">=</span> <span class="kc">true</span>
		<span class="k">end</span>
	<span class="k">elseif</span> <span class="n">event</span><span class="p">.</span><span class="n">axis</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">joy_axis</span><span class="p">.</span><span class="n">LX</span> <span class="k">then</span>
		<span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="n">event</span><span class="p">.</span><span class="n">value</span>
		<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">270</span><span class="p">)</span>
			<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
		<span class="k">elseif</span> <span class="n">event</span><span class="p">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
			<span class="n">moved</span> <span class="o">=</span> <span class="kc">true</span>
		<span class="k">end</span>
	<span class="k">end</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_paused</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="ow">not</span> <span class="n">moved</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">moved</span> <span class="k">then</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
	<span class="k">else</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">animated_sprite</span><span class="p">.</span><span class="n">set_frame</span><span class="p">(</span><span class="n">anim_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_joymapped_button_released</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">joy_button</span><span class="p">.</span><span class="n">GUIDE</span> <span class="k">then</span>
		<span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
	<span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_06_the_scenegraph">Tutorial #06 - The Scenegraph</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_transformations_and_the_scenegraph">The transformations and the scenegraph</h3>
<div class="paragraph">
<p>Until now we have always added our sprites to the root node of the scenegraph, without really explaining why or what the scenegraph is.</p>
</div>
<div class="paragraph">
<p>Each regular sprite, animated sprite, or text node is a scene node that can be added to the scenegraph in order to be rendered on screen.</p>
</div>
<div class="paragraph">
<p>The scenegraph is a tree that starts at the root node and that can have many branches (or children). Each node can then have children on its own.</p>
</div>
<div class="paragraph">
<p>Having a node that is a child of another one is useful to carry the parent transformations while transforming it independently.</p>
</div>
<div class="paragraph">
<p>Think of the Earth and the Moon. The Moon revolves around the Earth, but the Earth revolves around the Sun.
It is a lot easier to model those two movements independently instead of thinking about how the Moon revolves around the Sun.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_init</span><span class="p">()</span>
	<span class="n">texture_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"textures/texture4.png"</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_resolution</span><span class="p">()</span>
	<span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="p">{</span> <span class="n">x</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="p">}</span>
	<span class="n">sun_sprite_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_rootnode</span><span class="p">(),</span> <span class="n">texture_</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

	<span class="n">earth_sprite_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">sun_sprite_</span><span class="p">,</span> <span class="n">texture_</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">earth_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>

	<span class="n">moon_sprite_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">earth_sprite_</span><span class="p">,</span> <span class="n">texture_</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">moon_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>

	<span class="n">angle_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_frame_start</span><span class="p">()</span>
	<span class="n">angle_</span> <span class="o">=</span> <span class="n">angle_</span> <span class="o">+</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_frame_time</span><span class="p">()</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">sun_sprite_</span><span class="p">,</span> <span class="n">angle_</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">earth_sprite_</span><span class="p">,</span> <span class="n">angle_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">moon_sprite_</span><span class="p">,</span> <span class="n">angle_</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The second parameter of the <code>sprite.new()</code> function is the parent node of the sprite we are going to create.</p>
</div>
<div class="paragraph">
<p>Only the Sun is a child of the root node. Then the Earth is a child of the Sun and the Moon is a child of Earth.</p>
</div>
<div class="paragraph">
<p>With this setup it&#8217;s easy to model their revolution by just rotating them.</p>
</div>
<div class="paragraph">
<p>We have also scaled down the sprites to make their relation clearer. Both the Earth and the Moon have been scaled to half their original sizes, but the Moon inherits its parent transformation and ends up being scaled to a fourth of its original size.</p>
</div>
</div>
<div class="sect2">
<h3 id="_modifying_the_scenegraph">Modifying the scenegraph</h3>
<div class="paragraph">
<p>Assigning a parent when creating a new node is not the only way of changing the relationships inside the scenegraph.</p>
</div>
<div class="paragraph">
<p>There are many other functions that you can use to query or modify the associations between nodes.</p>
</div>
<div class="paragraph">
<p>If you want to know how many children does a parent node have you can use <code>num_children()</code>. You can then retrieve them by providing an index to <code>get_child()</code>.</p>
</div>
<div class="paragraph">
<p>You can also use the <code>get_children()</code> function and retrieve a list of all children in one go.</p>
</div>
<div class="paragraph">
<p>To retrieve the parent of a node use the <code>get_parent()</code> function, or set one with <code>set_parent()</code>.</p>
</div>
<div class="paragraph">
<p>You can use <code>add_child()</code> and <code>remove_child()</code> to add or remove a specific node object from a parent, or use <code>remove_child_at()</code> if you know the index.</p>
</div>
<div class="paragraph">
<p>If you want to remove all children from a node it is faster to call <code>remove_all_children()</code> than to cycle over them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_putting_it_all_together_6">Putting it all together</h3>
<div class="listingblock">
<div class="title">Complete example #06</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_init</span><span class="p">()</span>
	<span class="n">texture_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"textures/texture4.png"</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_resolution</span><span class="p">()</span>
	<span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="p">{</span> <span class="n">x</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="p">}</span>
	<span class="n">sun_sprite_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_rootnode</span><span class="p">(),</span> <span class="n">texture_</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

	<span class="n">earth_sprite_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">sun_sprite_</span><span class="p">,</span> <span class="n">texture_</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">earth_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>

	<span class="n">moon_sprite_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">earth_sprite_</span><span class="p">,</span> <span class="n">texture_</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">moon_sprite_</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>

	<span class="n">angle_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_frame_start</span><span class="p">()</span>
	<span class="n">angle_</span> <span class="o">=</span> <span class="n">angle_</span> <span class="o">+</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_frame_time</span><span class="p">()</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">sun_sprite_</span><span class="p">,</span> <span class="n">angle_</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">earth_sprite_</span><span class="p">,</span> <span class="n">angle_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">moon_sprite_</span><span class="p">,</span> <span class="n">angle_</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_shutdown</span><span class="p">()</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">moon_sprite_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">earth_sprite_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">sun_sprite_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">texture_</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_mouse_button_released</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">mouse_button</span><span class="p">.</span><span class="n">LEFT</span> <span class="k">then</span>
		<span class="k">if</span> <span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">get_parent</span><span class="p">(</span><span class="n">moon_sprite_</span><span class="p">)</span> <span class="o">==</span> <span class="n">earth_sprite_</span> <span class="k">then</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_parent</span><span class="p">(</span><span class="n">moon_sprite_</span><span class="p">,</span> <span class="n">sun_sprite_</span><span class="p">)</span>
		<span class="k">elseif</span> <span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">get_parent</span><span class="p">(</span><span class="n">moon_sprite_</span><span class="p">)</span> <span class="o">==</span> <span class="n">sun_sprite_</span> <span class="k">then</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_parent</span><span class="p">(</span><span class="n">moon_sprite_</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_rootnode</span><span class="p">())</span>
		<span class="k">elseif</span> <span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">get_parent</span><span class="p">(</span><span class="n">moon_sprite_</span><span class="p">)</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_rootnode</span><span class="p">()</span> <span class="k">then</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">set_parent</span><span class="p">(</span><span class="n">moon_sprite_</span><span class="p">,</span> <span class="n">earth_sprite_</span><span class="p">)</span>
		<span class="k">end</span>
	<span class="k">elseif</span> <span class="n">event</span><span class="p">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">nc</span><span class="p">.</span><span class="n">mouse_button</span><span class="p">.</span><span class="n">RIGHT</span> <span class="k">then</span>
		<span class="kd">local</span> <span class="n">sun_children</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">get_children</span><span class="p">(</span><span class="n">sun_sprite_</span><span class="p">)</span>
		<span class="k">if</span> <span class="o">#</span><span class="n">sun_children</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">num_children</span><span class="p">(</span><span class="n">earth_sprite_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
			<span class="n">nc</span><span class="p">.</span><span class="n">sprite</span><span class="p">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">earth_sprite_</span><span class="p">,</span> <span class="n">moon_sprite_</span><span class="p">)</span>
		<span class="k">end</span>
	<span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_07_mesh_sprites">Tutorial #07 - Mesh sprites</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_uses_of_a_mesh_sprite">Uses of a mesh sprite</h3>
<div class="paragraph">
<p>We have already discussed regular and animated sprites, but we left out mesh ones.</p>
</div>
<div class="paragraph">
<p>While regular and animated sprites are rendered as a rectangle made of two triangles, mesh sprites are based on an arbitrary mesh defined by the user.</p>
</div>
<div class="paragraph">
<p>You can define your own set of positions and UV coordinates and thus the shape of the sprite. While a regular rectangular sprite can still display any shape on screen by employing transparency, having a mesh define this shape can have <a href="https://developer.arm.com/documentation/102524/0100/Sprite-Geometry">better performance</a> on some platforms.</p>
</div>
<div class="paragraph">
<p>For example, instead a regular sprite with transparency, you can use two mesh sprites. One will cover the non-transparent part of your original sprite, while the second one will only cover the transparent part you might have along the border. This way, you can completely disable transparency while rendering the first one by using <code>set_blending_enabled(false)</code> and possibly achieve some performance gain.</p>
</div>
<div class="paragraph">
<p>There is also another, maybe more interesting, use for mesh sprites: animating the position of its vertices.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_mesh_sprite">Creating a mesh sprite</h3>
<div class="paragraph">
<p>In the following snippet, we create a simple sprite with a rectangular mesh. There are various ways to define the vertices, but to keep things simple we use <code>create_vertices_from_texels()</code>.</p>
</div>
<div class="paragraph">
<p>This function gets a list of coordinates in texture space (i.e. between 0 and the dimension of the texture in pixels) and creates a mesh sprite with the correct positions and UV coordinates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_init</span><span class="p">()</span>
	<span class="n">texture_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"textures/texture2.png"</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_resolution</span><span class="p">()</span>
	<span class="n">mesh_sprite_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">mesh_sprite</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_rootnode</span><span class="p">(),</span> <span class="n">texture_</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">mesh_sprite</span><span class="p">.</span><span class="n">create_vertices_from_texels</span><span class="p">(</span>
		<span class="n">mesh_sprite_</span><span class="p">,</span> <span class="p">{{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">128</span><span class="p">},</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">128</span><span class="p">}},</span> <span class="n">nc</span><span class="p">.</span><span class="n">texture_cut_mode</span><span class="p">.</span><span class="n">RESIZE</span>
	<span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You should also provide a cut mode (either <code>nc.texture_cut_mode.RESIZE</code> or <code>nc.texture_cut_mode.CROP</code>) to select how the algorithm will cut the texture with the edges you define.</p>
</div>
<div class="paragraph">
<p>In this case, we are just encompassing the whole texture (whose dimensions are 128x128) with a rectangle by specifying four vectors that span the entire surface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_defining_a_list_of_vertices">Defining a list of vertices</h3>
<div class="paragraph">
<p>Let&#8217;s now see a different way of defining our vertices, that will later help animate them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua">	<span class="kd">local</span> <span class="n">vertices</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">},</span>

		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">},</span>

		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">},</span>

		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">},</span>
	<span class="p">}</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">mesh_sprite</span><span class="p">.</span><span class="n">copy_vertices</span><span class="p">(</span><span class="n">mesh_sprite_</span><span class="p">,</span> <span class="n">vertices</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are defining a list of vertices by specifying the positions and UV coordinates (both going from 0 to 1 to span the whole texture space) and using the <code>copy_vertices()</code> function. Just keep in mind that the <code>v</code> coordinate goes in the opposite direction, so if <code>y = 0.0</code> then <code>v = 1.0</code> and vice versa.</p>
</div>
<div class="paragraph">
<p>As you can notice, the list defines four triangles but repeats the last vertex. The repeated one is called a <em>degenerate vertex</em> and is needed to achieve our topology: a rectangle with a shared center vertex.</p>
</div>
<div class="paragraph">
<p>Mesh sprites use <code>GL_TRIANGLE_STRIP</code> primitives, where each new triangle is defined by a vertex and the two preceding it. In this case, it would have come in handy to have <code>GL_TRIANGLE_FAN</code> primitives but there is currently no way to change this.</p>
</div>
<div class="paragraph">
<p>We could have also equivalently used the <code>create_vertices_from_texels()</code> function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua">	<span class="kd">local</span> <span class="n">texels</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>  <span class="n">y</span> <span class="o">=</span> <span class="mi">64</span> <span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>  <span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>  <span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>  <span class="p">},</span>

		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>  <span class="n">y</span> <span class="o">=</span> <span class="mi">64</span> <span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>  <span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">128</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">128</span><span class="p">},</span>

		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">64</span> <span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">64</span> <span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">128</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>  <span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">128</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>  <span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">128</span><span class="p">},</span>

		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">64</span> <span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">64</span> <span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>  <span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">128</span><span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>  <span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>  <span class="p">},</span>
		<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>  <span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">},</span>
	<span class="p">}</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">mesh_sprite</span><span class="p">.</span><span class="n">create_vertices_from_texels</span><span class="p">(</span><span class="n">mesh_sprite_</span><span class="p">,</span> <span class="n">texels</span><span class="p">,</span> <span class="n">nc</span><span class="p">.</span><span class="n">texture_cut_mode</span><span class="p">.</span><span class="n">RESIZE</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_animating_the_vertices">Animating the vertices</h3>
<div class="paragraph">
<p>And now for the fun part: animating the vertices!</p>
</div>
<div class="paragraph">
<p>But first let&#8217;s define the vertices in yet another way, the fastest one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua">	<span class="n">vertices_</span> <span class="o">=</span> <span class="p">{</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>
		<span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>

		 <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>

		 <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		<span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		<span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>

		 <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>
		<span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		<span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		<span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
	<span class="p">}</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">mesh_sprite</span><span class="p">.</span><span class="n">emplace_vertices</span><span class="p">(</span><span class="n">mesh_sprite_</span><span class="p">,</span> <span class="n">vertices_</span><span class="p">)</span>

	<span class="n">sprite_vertices_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">mesh_sprite</span><span class="p">.</span><span class="n">get_vertices</span><span class="p">(</span><span class="n">mesh_sprite_</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By using <code>emplace_vertices()</code> we spare an internal copy. Besides, the list is now a table of numbers instead of a table of tables, making its parsing even faster.</p>
</div>
<div class="paragraph">
<p>We have also moved the center of the rectangle to the origin by subtracting 0.5 to both its <code>x</code> and <code>y</code> coordinates.</p>
</div>
<div class="paragraph">
<p>You can notice the non-<code>local</code> <code>vertices_</code> and <code>sprite_vertices_</code> variables, they will both be used in the <code>on_frame_start()</code> function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_frame_start</span><span class="p">()</span>
	<span class="n">angle_</span> <span class="o">=</span> <span class="n">angle_</span> <span class="o">+</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_frame_time</span><span class="p">()</span>

	<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="o">#</span><span class="n">sprite_vertices_</span> <span class="k">do</span>
		<span class="kd">local</span> <span class="n">mod</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span>
		<span class="k">if</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
			<span class="n">sprite_vertices_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertices_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">25</span> <span class="o">+</span> <span class="nb">math.sin</span><span class="p">(</span><span class="n">angle_</span><span class="p">)</span> <span class="o">*</span> <span class="nb">math.sin</span><span class="p">(</span><span class="n">angle_</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">75</span><span class="p">)</span>
		<span class="k">elseif</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">then</span>
			<span class="n">sprite_vertices_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertices_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">25</span> <span class="o">+</span> <span class="nb">math.cos</span><span class="p">(</span><span class="n">angle_</span><span class="p">)</span> <span class="o">*</span> <span class="nb">math.cos</span><span class="p">(</span><span class="n">angle_</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">75</span><span class="p">)</span>
		<span class="k">end</span>
	<span class="k">end</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">mesh_sprite</span><span class="p">.</span><span class="n">emplace_vertices</span><span class="p">(</span><span class="n">mesh_sprite_</span><span class="p">,</span> <span class="n">sprite_vertices_</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are using again an <code>angle_</code> parameter to animate with trigonometric functions.</p>
</div>
<div class="paragraph">
<p>The <code>for</code> loop iterates over all <code>sprite_vertices_</code> (skipping the first one) and alters them by applying a function to the original <code>vertices_</code> list. In this case, only the <code>x</code> and <code>y</code> coordinates will be modified, thanks to a modulo division that selects the right components.</p>
</div>
<div class="paragraph">
<p>We then use the <code>emplace_vertices()</code> function to update their values.</p>
</div>
</div>
<div class="sect2">
<h3 id="_putting_it_all_together_7">Putting it all together</h3>
<div class="listingblock">
<div class="title">Complete example #07</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="n">nc</span> <span class="o">=</span> <span class="n">ncine</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_init</span><span class="p">()</span>
	<span class="n">texture_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">get_data_path</span><span class="p">()</span><span class="o">..</span><span class="s2">"textures/texture2.png"</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_resolution</span><span class="p">()</span>
	<span class="n">mesh_sprite_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">mesh_sprite</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_rootnode</span><span class="p">(),</span> <span class="n">texture_</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">resolution</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>

	<span class="n">vertices_</span> <span class="o">=</span> <span class="p">{</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>
		<span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>

		 <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>

		 <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		<span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		<span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>

		 <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>
		<span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		<span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
		<span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
	<span class="p">}</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">mesh_sprite</span><span class="p">.</span><span class="n">emplace_vertices</span><span class="p">(</span><span class="n">mesh_sprite_</span><span class="p">,</span> <span class="n">vertices_</span><span class="p">)</span>

	<span class="n">sprite_vertices_</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">mesh_sprite</span><span class="p">.</span><span class="n">get_vertices</span><span class="p">(</span><span class="n">mesh_sprite_</span><span class="p">)</span>

	<span class="n">angle_</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_frame_start</span><span class="p">()</span>
	<span class="n">angle_</span> <span class="o">=</span> <span class="n">angle_</span> <span class="o">+</span> <span class="n">nc</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">get_frame_time</span><span class="p">()</span>

	<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="o">#</span><span class="n">sprite_vertices_</span> <span class="k">do</span>
		<span class="kd">local</span> <span class="n">mod</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span>
		<span class="k">if</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
			<span class="n">sprite_vertices_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertices_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">25</span> <span class="o">+</span> <span class="nb">math.sin</span><span class="p">(</span><span class="n">angle_</span><span class="p">)</span> <span class="o">*</span> <span class="nb">math.sin</span><span class="p">(</span><span class="n">angle_</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">75</span><span class="p">)</span>
		<span class="k">elseif</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">then</span>
			<span class="n">sprite_vertices_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertices_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">25</span> <span class="o">+</span> <span class="nb">math.cos</span><span class="p">(</span><span class="n">angle_</span><span class="p">)</span> <span class="o">*</span> <span class="nb">math.cos</span><span class="p">(</span><span class="n">angle_</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">75</span><span class="p">)</span>
		<span class="k">end</span>
	<span class="k">end</span>

	<span class="n">nc</span><span class="p">.</span><span class="n">mesh_sprite</span><span class="p">.</span><span class="n">emplace_vertices</span><span class="p">(</span><span class="n">mesh_sprite_</span><span class="p">,</span> <span class="n">sprite_vertices_</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">nc</span><span class="p">.</span><span class="nf">on_shutdown</span><span class="p">()</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">mesh_sprite</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">mesh_sprite_</span><span class="p">)</span>
	<span class="n">nc</span><span class="p">.</span><span class="n">texture</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">texture_</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>